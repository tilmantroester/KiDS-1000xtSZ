[DEFAULT]
run_name = base_setup
root_dir = runs/%(RUN_NAME)s/
csl_path = %(KCAP_PATH)s/cosmosis-standard-library
kcap_path = /Users/yooken/Research/KiDS/kcap/
hmx_path = %(KCAP_PATH)s/../HMx/python_interface/
triad_path = /Users/yooken/Research/project_triad/KiDS1000_tSZ/
data_dir = %(ROOT_DIR)s/data/
output_dir = %(ROOT_DIR)s/output/
config_dir = %(ROOT_DIR)s/config/

[pipeline]
modules = sample_S8 sigma8toAs correlate_dz camb hmx extrapolate_power load_source_nz source_photoz_bias linear_alignment projection cib_contamination beam_filter_cls pixwin_filter_cls tSZ_like
values = %(CONFIG_DIR)s/values.ini
priors = %(CONFIG_DIR)s/priors.ini
likelihoods = tsz_like
extra_output = cosmological_parameters/S_8 cosmological_parameters/sigma_8 cosmological_parameters/A_s cosmological_parameters/omega_m cosmological_parameters/omega_nu cosmological_parameters/omega_lambda nofz_shifts/bias_1 nofz_shifts/bias_2 nofz_shifts/bias_3 nofz_shifts/bias_4 nofz_shifts/bias_5
quiet = F
timing = T
debug = F

[runtime]
sampler = multinest

[output]
filename = %(OUTPUT_DIR)s/samples_%(RUN_NAME)s.txt
format = text

[multinest]
max_iterations = 10000
multinest_outfile_root = %(OUTPUT_DIR)s/multinest/multinest_%(RUN_NAME)s_
update_interval = 20
resume = T
live_points = 250
efficiency = 0.8
tolerance = 0.1
constant_efficiency = F

[emcee]
walkers = 80
samples = 10000
covmat = 
nsteps = 5

[test]
save_dir = %(OUTPUT_DIR)s/data_block
fatal_errors = T

[maxlike]
method = Nelder-Mead
tolerance = 0.001
maxiter = 10000
max_posterior = T
output_steps = T
flush_steps = 1

[sample_S8]
file = %(KCAP_PATH)s/utils/sample_S8.py
s8_name = S_8_input

[sigma8toAs]
file = %(KCAP_PATH)s/utils/sigma8toAs.py

[correlate_dz]
file = %(KCAP_PATH)s/utils/correlated_priors.py
uncorrelated_parameters = nofz_shifts/p_1 nofz_shifts/p_2 nofz_shifts/p_3 nofz_shifts/p_4 nofz_shifts/p_5
output_parameters = nofz_shifts/bias_1 nofz_shifts/bias_2 nofz_shifts/bias_3 nofz_shifts/bias_4 nofz_shifts/bias_5
covariance = %(DATA_DIR)s/correlate_dz/SOM_cov_multiplied.asc

[camb]
file = %(CSL_PATH)s/boltzmann/pycamb/camb_interface.py
do_reionization = F
mode = transfer
nonlinear = none
neutrino_hierarchy = normal
kmax = 20.0
zmid = 1.5
nz_mid = 8
zmax = 6.0
nz = 11
background_zmax = 6.0
background_zmin = 0.0
background_nz = 6000

[hmx]
file = %(HMX_PATH)s/cosmosis_interface.py
mode = HMx2020_matter_pressure
fields = matter pressure

[extrapolate_power]
file = %(CSL_PATH)s/boltzmann/extrapolate/extrapolate_power.py
kmax = 500.0
sections = matter_pressure_power_spectrum pressure_pressure_power_spectrum

[load_source_nz]
file = %(CSL_PATH)s/number_density/load_nz/load_nz.py
filepath = %(DATA_DIR)s/load_source_nz/K1000_NS_V1.0.0A_ugriZYJHKs_photoz_SG_mask_LF_svn_309c_2Dbins_v2_DIRcols_Fid_blindC_TOMO1_Nz.asc %(DATA_DIR)s/load_source_nz/K1000_NS_V1.0.0A_ugriZYJHKs_photoz_SG_mask_LF_svn_309c_2Dbins_v2_DIRcols_Fid_blindC_TOMO2_Nz.asc %(DATA_DIR)s/load_source_nz/K1000_NS_V1.0.0A_ugriZYJHKs_photoz_SG_mask_LF_svn_309c_2Dbins_v2_DIRcols_Fid_blindC_TOMO3_Nz.asc %(DATA_DIR)s/load_source_nz/K1000_NS_V1.0.0A_ugriZYJHKs_photoz_SG_mask_LF_svn_309c_2Dbins_v2_DIRcols_Fid_blindC_TOMO4_Nz.asc %(DATA_DIR)s/load_source_nz/K1000_NS_V1.0.0A_ugriZYJHKs_photoz_SG_mask_LF_svn_309c_2Dbins_v2_DIRcols_Fid_blindC_TOMO5_Nz.asc
histogram = T
output_section = nz_KiDS1000

[source_photoz_bias]
file = %(CSL_PATH)s/number_density/photoz_bias/photoz_bias.py
mode = additive
sample = nz_KiDS1000
bias_section = nofz_shifts
interpolation = cubic
output_deltaz = T
output_section_name = delta_z_out

[linear_alignment]
file = %(CSL_PATH)s/intrinsic_alignments/la_model/linear_alignments_interface.py
method = bk_corrected
x_matter_power_section = matter_pressure_power_spectrum
x_intrinsic_power_output_section = pressure_intrinsic_power_spectrum

[projection]
file = %(CSL_PATH)s/structure/projection/project_2d.py
ell_min = 2.0
ell_max = 6001.0
n_ell = 400
shear-shear = KiDS1000-KiDS1000
shear-y = KiDS1000-y
intrinsic-y = KiDS1000-y
verbose = F
get_kernel_peaks = F

[cib_contamination]
file = %(TRIAD_PATH)s/tools/CIB_contamination.py
cov_file = %(DATA_DIR)s/cib_contamination/shear_CIB_KiDS1000_545_TE_jk_3.4deg2_beam10_cov.txt
data_file = %(DATA_DIR)s/cib_contamination/shear_CIB_KiDS1000_545_TE_beam10.txt
cib_section = shear_CIB_cl
tsz_cib_contamination_section = shear_y_CIB_contamination_cl

[beam_filter_cls]
file = %(TRIAD_PATH)s/tools/filter_cls.py
filter = gaussian
fwhm = 10.0
sections = shear_y_cl y_y_cl intrinsic_y_cl
powers = 1 2 1
new_section_suffix = beam

[pixwin_filter_cls]
file = %(TRIAD_PATH)s/tools/filter_cls.py
filter = healpix_window
nside = 2048
sections = shear_y_cl_beam y_y_cl_beam intrinsic_y_cl_beam
powers = 2 2 2
new_section_suffix = pixwin

[tSZ_like]
file = %(TRIAD_PATH)s/tools/tsz_like.py
like_name = tsz_like
cov_file = %(DATA_DIR)s/tSZ_like/shear_y_KiDS1000_milca_TE_gaussian_cNG_cov.txt
data_file = %(DATA_DIR)s/tSZ_like/shear_y_KiDS1000_milca_TE.txt
bin_operator_file = %(DATA_DIR)s/tSZ_like/bin_operator_w_spice_8_log_ell_bin_40-2000.txt
input_section_name = shear_y_cl_beam_pixwin
ia_section_name = intrinsic_y_cl_beam_pixwin
cib_contamination_section_name = shear_y_CIB_contamination_cl_binned
new_section_suffix = binned

